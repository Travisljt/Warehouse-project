# 仓库管理系统（WMS）与仓库控制系统（WCS）功能说明

## 1. 项目总体概述
- **目标**：构建一个覆盖从入库、在库、出库到设备自动化联动的端到端解决方案，实现库存精准可视、作业流程标准化、实时调度与安全合规。
- **架构定位**：WMS 负责业务流程、数据与决策层；WCS 负责执行层设备调度、动作优化与反馈闭环。两者通过标准化接口和事件驱动机制互联。
- **技术要点**：支持多仓多货主、多渠道订单、物联网设备接入、可视化监控、可扩展 API。

## 2. 仓库管理系统（WMS）功能

### 2.1 主数据管理
- **货主/客户管理**：支持多货主合同、计费规则、结算周期配置。
- **物料与SKU**：含规格、批号、保质期、序列号、条码/二维码、包装层级。
- **库区/库位**：可配置温区、危化/贵品区域、混放规则、容积与载重限制。
- **作业策略**：波次规则、分拣策略、补货逻辑、批属性控制。

### 2.2 入库管理
- 预约与ASN：供应商预约、多时间窗管理、自动生成到货任务。
- 上架策略：先进先出、批次隔离、同批合并、跨库区补货。
- 质检与异常：抽检计划、质检单、滞留区管理、差异单闭环。

### 2.3 库存与在库作业
- 实时库存：多维（批次、库区、容器、序列号）可视化，支持冻结/解冻。
- 循环盘点：定期/抽盘/动碰监控，盘盈盘亏处理流程。
- 补货与移库：自动触发、波次执行、路径校验、任务回传。

### 2.4 出库管理
- 订单管理：多渠道（B2B/B2C/门店/跨境），优先级、承诺交期。
- 波次与拣选：支持整托、整箱、拆零，合并/分拆波次，波次模拟成本。
- 包装与复核：容器追踪、称重校验、电子面单与批量交运。

### 2.5 作业执行与劳动力
- 任务分配：按角色、技能、设备匹配，支持移动端推送与实时进度。
- 员工绩效：任务完成率、标准工时对比、异常记录。
- 安全合规：培训记录、证书到期提醒。

### 2.6 指标与报表
- KPI：库存准确率、订单准时率、库容利用率、拣货效率等。
- 可视化：看板、热力图、趋势图，自定义指标组合。
- 数据接口：BI 导出、API、消息事件。

### 2.7 系统集成
- ERP/MES/OMS 接口：订单、采购、生产任务双向同步。
- TMS/承运商：运单号、运价、承运进度回传。
- IoT/自动化：与 WCS、AGV、穿梭车等设备标准接口。

## 3. 仓库控制系统（WCS）功能

### 3.1 设备与现场资源管理
- 设备档案：输送线、堆垛机、AGV、AMR、穿梭车、自动包装线等。
- 状态监控：实时运行状态、故障码、能源消耗、维护计划。
- 控制策略：优先级队列、冲突检测、路径规划算法。

### 3.2 任务调度
- 任务接收：从 WMS/ERP 获取入出库、移库、补货任务。
- 任务拆解：拆分子任务（搬运、升降、分拣、缓存），按资源负载分配。
- 优化算法：基于最短路径、最少搬运、能耗/拥堵模型动态调整。

### 3.3 动作执行与反馈
- 指令下发：PLC、机器人、AGV 控制协议（OPC UA、MQTT、Modbus）。
- 反馈采集：传感器数据、进程状态、异常事件实时回传。
- 闭环控制：任务完成确认、异常重试、人工接管机制。

### 3.4 安全与容错
- 安全栅格：区域联锁、紧急停止、速度限制。
- 故障处理：容错切换、任务回滚、备份通道。
- 维护工单：自动生成设备维修记录，与 CMMS 对接。

### 3.5 可视化与报警
- 实时 3D/2D 监控：展示设备位置、路径、队列长度。
- 告警中心：多级告警、短信/邮件/语音推送、SLA 统计。
- 回溯分析：历史任务轨迹、事件录像、故障原因。

## 4. WMS-WCS 协同
- **接口模式**：REST/GraphQL API、消息队列（Kafka/RabbitMQ）、事件驱动。
- **数据同步**：任务状态、库存状态、设备能力，双向更新。
- **调度协同**：WMS 生成任务队列，WCS 实时反馈执行能力，双方共同优化波次与路径。
- **异常联动**：WCS 故障推送至 WMS，WMS 重排任务或改人工；WMS 库存差异触发 WCS 复核任务。

## 5. 安全与合规
- 身份与权限：RBAC、细粒度操作审计、多因素登录。
- 数据安全：主数据加密、传输 TLS、日志脱敏。
- 合规要求：危化品、医药冷链、食品安全等行业标准。

## 6. 可扩展性与实施路线
- 模块化部署：可先上线基础 WMS，逐步接入 WCS 与自动化。
- 多租户能力：支持多仓独立配置、统一监控。
- 二次开发：插件机制、脚本引擎、低代码规则配置。
- 实施阶段：需求调研 → 原型 → 核心流程试点 → 自动化联调 → 验收。

## 7. 后续工作
- 详细需求梳理与原型设计。
- 技术选型（数据库、消息中间件、设备协议栈）。
- 数据模型、接口规范与安全策略制定。
- MVP 迭代计划与验收标准。

## 8. 前端架构设计（Vue 3 + Nginx）
- **整体模式**：采用单页应用（SPA）+ 微前端预留扩展，Vue 3 + Vite 构建，Nginx 提供静态资源分发与反向代理。
- **模块划分**：
  - `核心运营驾驶舱`：实时 KPI、波次进度、设备状态可视化。
  - `业务作业中心`：入库、出库、库存、盘点、任务等功能模块，以路由+动态组件实现按需加载。
  - `设备监控与报警`：3D/2D 场景展示、告警墙、事件时间轴。
  - `配置与主数据`：策略配置、主数据维护、权限管理。
- **状态管理**：Pinia + Composition API；区分业务状态（库存、订单等）与 UI 状态（布局、主题）；与后端通过 GraphQL/REST 封装统一数据访问层。
- **通信方案**：
  - HTTP API：Axios + 拦截器处理鉴权、重试、错误提示。
  - 实时通道：WebSocket/SSE 订阅设备、库存事件；消息解耦采用轻量事件总线。
- **可视化**：ECharts/Three.js 绘制 KPI 与 3D 仓图；Mapbox/Canvas 用于路径与AGV位置。
- **鉴权与安全**：Nginx 终端SSL、JWT/Token存储于 HttpOnly Cookie；路由守卫 + 组件权限指令；对接 SSO。
- **部署与运维**：Nginx 多实例容灾，使用蓝绿发布；资源压缩与分包策略（路由级+组件级懒加载）；CSP 与静态资源版本化。

## 9. 后端分布式微服务架构（Spring Boot + RabbitMQ/Kafka + Redis + PostgreSQL）
- **总体拓扑**：
  - API 网关（Spring Cloud Gateway/Nginx）负责统一入口、鉴权、限流、灰度。
  - 服务注册与配置中心（Nacos/Consul + Spring Cloud Config）管理服务发现与配置。
  - 消息中间件选型：RabbitMQ（适合指令与任务编排场景）或 Kafka（适合高吞吐事件流），承担仓库任务、库存事件、设备事件总线。
  - Redis 作为缓存、会话、分布式锁，实现热点数据与队列。
  - PostgreSQL 作为主存储，分库分表（主数据、作业数据、日志数据）并结合 logical replication。
- **核心服务划分**：
  - `MasterDataService`：货主、SKU、库位等主数据，提供只读副本缓存。
  - `InboundService / OutboundService`：入库、出库流程编排，支持 Saga/补偿事务。
  - `InventoryService`：库存台账、冻结/解冻、盘点任务，采用事件溯源 + 冗余快照。
  - `TaskOrchestrationService`：波次、任务拆分、优先级计算，与 WCS 协议对接。
  - `WcsIntegrationService`：与设备控制层双向通信，封装指令、状态回传。
  - `MonitoringService`：告警、日志、审计，与 Prometheus/Grafana 打通。
  - `AuthService`：RBAC、多租户、OAuth2/OIDC。
- **数据流与消息**：
  - Kafka Topic 或 RabbitMQ Exchange/Queue 示例：`wms.inbound`, `wms.outbound`, `inventory.events`, `wcs.feedback`。
  - 采用事务消息保障跨服务一致性；消费者幂等处理，消息落表追踪。
- **数据库设计要点**：
  - PostgreSQL 使用 JSONB 存储可扩展字段，结合行级锁处理关键库存表。
  - CDC（Debezium + Kafka Connect 或 CDC → RabbitMQ）的增量事件推动 BI/报表。
- **缓存与性能**：
  - Redis Cluster 提供库存快照、任务队列、分布式锁（基于 Redlock）。
  - 热点数据旁路缓存 + 过期/主动失效策略。
- **可靠性与安全**：
  - 全链路追踪（Sleuth + Zipkin/Tempo）、统一日志（ELK）。
  - 雪崩防护：熔断、限流、降级策略；多 AZ 部署 + 自动扩缩容。
  - 数据安全：PostgreSQL TDE/行级权限；敏感数据脱敏服务。
